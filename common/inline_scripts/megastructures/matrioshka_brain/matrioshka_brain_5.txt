entity = "matrioshka_brain_05_entity"
construction_entity = "matrioshka_brain_p5_entity"
portrait = "GFX_megastructure_sentient_AI"
upgrade_from = { matrioshka_brain_4_$class$_star }
ai_weight = { factor = value:giga_ai_base_continue } # If we can build it, we will build it

country_modifier = {
    all_technology_research_speed = 0.15
}

build_time = @[ 5400 * giga_$class$_star_time_mult ]
resources = {
    category = giga_gigastructures
    cost = {
        alloys = @[ 50 * giga_$class$_star_cost_mult * 1000 ]
        unity = @[ 10 * giga_$class$_star_cost_mult * 1000 ]
    }
    cost = { alloys = -1 multiplier = value:giga_ai_savings_cost|CATEGORY|important|RESOURCE|alloys|AMOUNT|@[ 50 * giga_$class$_star_cost_mult * 1000 ]| }
    cost = { unity = -1 multiplier = value:giga_ai_savings_cost|CATEGORY|important|RESOURCE|unity|AMOUNT|@[ 10 * giga_$class$_star_cost_mult * 1000 ]| }
    produces = {
        physics_research     = @[ 5000 * giga_$class$_star_production_mult ]
        society_research     = @[ 5000 * giga_$class$_star_production_mult ]
        engineering_research = @[ 5000 * giga_$class$_star_production_mult ]
    }
    upkeep = {
        trigger = { NOT = { has_global_flag = giga_disable_influence_upkeep } }
        influence = @[ 1.5 * giga_$class$_star_influence_mult ]
    }
    upkeep = {
        alloys = @[ 200 * giga_$class$_star_upkeep_mult ]
    }
}

on_build_start = {
    giga_ai_savings_withdraw = { 
        CATEGORY = important 
        RESOURCE = alloys 
        AMOUNT = @[ 50 * giga_$class$_star_cost_mult * 1000 ]
    }
    giga_ai_savings_withdraw = { 
        CATEGORY = important 
        RESOURCE = unity  
        AMOUNT = @[ 10 * giga_$class$_star_cost_mult * 1000 ]
    }
}

potential = { NOT = { has_global_flag = matrioshka_brain_disabled } }
possible = {
    from = {
        has_gigastructural_constructs = yes
        has_technology = giga_tech_matrioshka_brain_1
    }
}

on_build_complete = {
    save_event_target_as = giga_system
    if = { limit = { exists = fromfrom.planet } fromfrom.planet = { save_event_target_as = giga_planet } }
    from = {
        country_event = { id = giga_dialog.506 }	# Notification
        if = {
            limit = {
                NOR = {
                    has_global_flag = giga_achievements_disabled
                    has_country_flag = giga_achievement_85
                }
            }
            set_country_flag = giga_achievement_85
            set_timed_country_flag = { flag = giga_achievement_85_notification days = 30 }
            giga_achievement_sound = yes
        }
    }
}